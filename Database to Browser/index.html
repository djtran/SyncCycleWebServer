<!DOCTYPE html>
<meta charset="utf-8">
<style>
  .container {
    width: 80%;
    margin: 15px auto;
  }

  html,body,.container-fluid, .col-md-3,.row {
    height:100%;
  }

  .row > div {
    height:100%;
  }

  .button-row {
    background-color: #6fb9d6;
    height: 100%;
  }

  * {
    font-family: 'Open Sans', sans-serif;
  }

  body {
    background-color: #6fb9d6;
  }

  button {
    margin-left: 30px;
  }

  .axis path {
    fill: none;
    stroke: #777;
    shape-rendering: crispEdges;
  }
  .axis text {
    font-family: 'Open Sans', sans-serif;
    font-size: 13px;
  }

</style>
<head>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.1.4/Chart.min.js"></script>
  <script src="http://d3js.org/d3.v3.js"></script>
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
  <link href="http://getbootstrap.com/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- <link href="http://getbootstrap.com/examples/justified-nav/justified-nav.css" rel="stylesheet"> -->
</head>
<body>

<!-- <h3>My Google Maps Demo</h3>
<div id="map">
</div> -->

<div class="container-fluid">

  <div class="row">
    <div class="col-md-3 no-float">

      <div class="button-row row">
        <button type="button" class="myButton">Get Data</button>
      </div>
    </div>
    <div class="col-md-1">
    </div>
    <div class="col-md-7">
      <div class="title row" style="backgroundColor: #EEEEEE">
      </div>
      <div class="dump row" style="margin-top: -650px;">
        <svg id="chart" width="1000" height="500"></svg>
      </div>


    </div>
    <div class="col-md-1">
    </div>
  </div>


</div>

<!-- <script>
  function initMap() {
    var uluru = {lat: -25.363, lng: 131.044};
    var map = new google.maps.Map(document.getElementById('map'), {
      zoom: 4,
      center: uluru
    });
    var marker = new google.maps.Marker({
      position: uluru,
      map: map
    });
  }
</script>
<script async defer
src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC0CuPxHmmokSyqM3DfvhlNbNsL1kxJkio&callback=initMap">
</script> -->

<script>

function plotSVG(data) {

  console.log(data);

  var vis = d3.select("#chart");
  var WIDTH = 700;
  var HEIGHT = 350;
  var MARGINS = {
        top: 20,
        right: 20,
        bottom: 20,
        left: 50
  };

  var xScale = d3.scale.linear().range([MARGINS.left, WIDTH - MARGINS.right]).domain([0,100]);
  var yScale = d3.scale.linear().range([HEIGHT - MARGINS.top, MARGINS.bottom]).domain([0,25]);

  var xAxis = d3.svg.axis().scale(xScale);
  var yAxis = d3.svg.axis()
    .scale(yScale)
    .orient("left");

  vis.append("text")
    .attr("transform",
          "translate(" + (WIDTH/2) + " ," +
                         (HEIGHT + MARGINS.top + 5) + ")")
    .style("text-anchor", "middle")
    .text("TIME (s)");

  // text label for the y axis
  vis.append("text")
      .attr("transform", "rotate(-90)")
      .attr("y", 0 + MARGINS.left)
      .attr("x", 0 + (HEIGHT / 2))
      .attr("dy", "-90em")
      .style("text-anchor", "middle")
      .text("SPEED (mph)");

  vis.append("svg:g")
    .attr("class", "axis")
    .attr("transform", "translate(0," + (HEIGHT - MARGINS.bottom) + ")")
    .style("text-anchor", "end")
    .text("Number of Applicatons")
    .call(xAxis);

  vis.append("svg:g")
    .attr("class", "axis")
    .attr("transform", "translate(" + MARGINS.left + ",0)")
    .call(yAxis);

  var lineGen = d3.svg.line()
    .x(function(d) {
      return xScale(d.time);
    })
    .y(function(d) {
      return yScale(d.value);
    })
    .interpolate("basis");

  vis.append('svg:path')
    .attr('d', lineGen(data))
    .attr('stroke', 'blue')
    .attr('stroke-width', 2)
    .attr('fill', 'none');

}

var dump = [];
var times = [];
var values = [];

var max = 0;

$('.myButton').on("click", function(){
    // GET RIDES
    $.getJSON("http://localhost:8080/list/rides", function(result){
        $.each(result, function(i, field){
            var newElement = '<button type="button" class="rideButton col-md-12" id="'
            + field + '" > Ride ' + (i+1) + ' </button>';
            $(".button-row").append(newElement);
            console.log(newElement);
        });

    });
});

$(document).one("click", ".rideButton", function() {
    times = [];
    values = [];

    var fullData;

    var newTitle = '<h2>SPEEDOMETER DATA FOR RIDE ' + this.id[this.id.length - 1] + ' </h2>';
    //$(document).not($(".title").has("h2")).append(newTitle);

    //$(".title:not(:has(>h2)").append(newTitle);

    $(".title").append(newTitle);

    // if ($(".title").length > 0) {
    //
    // }
    //$(".title").has( "h2" ).length ? : $(".title").has("h2").append(newTitle);

    $.getJSON('http://localhost:8080/data/' + this.id + '/Sensor.speedometer', function(result) {
        fullData = result;
        console.log(result);
        $.each(result, function(i, obj) {
            dump.push(obj);
            times.unshift(obj.time);
            values.push(obj.value);

        });

        plotSVG(fullData);
        console.log(max);
    });

    //var myChart = graph(times, values);


    //console.log(max);
});



//Chart code



function graph(time, value) {
    $(".title").append('<canvas id="myChart"></canvas>');

    var ctx = $("#myChart");

    // var img = new Image();
    // img.src = 'https://i.imgur.com/oowp94M.jpg';
    // var fillPattern = ctx.createPattern(img, 'repeat');
    // Chart.defaults.global.elements.line.tension = .2;
    // Chart.defaults.global.elements.line.borderWidth = 2;
    // Chart.defaults.global.elements.line.borderColor = 'rgba(1,1,1,1.0)';

    // Chart.defaults.global.elements.point.borderColor = 'rgba(0,0,0,1.0)';
    // Chart.defaults.global.elements.point.borderWidth = 1;
    var myChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: time,
        datasets: [{
          label: 'Key',
          data: value,
          pointRadius: 1,
          pointHoverRadius: 10
        }],
      },
      options: {
        scales: {
            xAxes: [{
                display: true,
                scaleLabel: {
                  display: true,
                  labelString: 'TIME (s)'
                }
            }],
            yAxes: [{
                display: true,
                scaleLabel: {
                  display: true,
                  labelString: 'SPEED (mph)'
                }
            }]
        },
        title:{
                  display: true,
                  text:"Values"
              }
      }
    });

    return myChart;
}
</script>
</body>
