<!DOCTYPE html>
<meta charset="utf-8">
<style>
  .container {
    width: 80%;
    margin: 15px auto;
  }

  h2 {
    font-family: 'Open Sans', sans-serif;
    font-size: 50px;
    color: #FFFFFF;
  }

  body {
    background-color: #6fb9d6;
  }

  button {
    margin-left: 30px;
  }

</style>
<head>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.1.4/Chart.min.js"></script>
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
</head>
<body>
<div>
  <button type="button" class="myButton">Click Me!</button>
</div>

<div class="dump">
</div>

<div class="container" style="backgroundColor: #EEEEEE">
  <h2>DEMO GRAPH</h2>

</div>
<script>



var dump = [];

var times = [];
var values = [];

$('.myButton').on("click", function(){
    //Some code
    $.getJSON("http://localhost:8080/list/rides", function(result){
        $.each(result, function(i, field){
            //dump.push(field);
            //$(".dump").append(field + " ");
            var newElement = '<button type="button" class="rideButton" id="'
            + field + '" > My ride </button>';
            $(".dump").append(newElement);
            console.log(newElement);
        });
    });
});

$(document).on("click", ".rideButton", function() {
    times = [];
    values = [];
    $.getJSON('http://localhost:8080/data/' + this.id + '/Sensor.speedometer', function(result) {
        $.each(result, function(i, obj) {
            dump.push(obj);
            times.unshift(obj.time);
            values.push(obj.value);
        });
    });
    console.log(dump);
    var myChart = graph(times, values);
    //myChart.update();
    //myChart.data.datasets[0].data = values;
    //myChart.data.labels = times;
    //myChart.reset();
    //myChart.update();
    //myChart.render(500, false);
});



//Chart code

function graph(time, value) {
    $(".container").append('<canvas id="myChart"></canvas>');

    //var ctx = document.getElementById('myChart').getContext('2d');
    var ctx = $("#myChart");

    // var img = new Image();
    // img.src = 'https://i.imgur.com/oowp94M.jpg';
    // var fillPattern = ctx.createPattern(img, 'repeat');
    // Chart.defaults.global.elements.line.tension = .2;
    // Chart.defaults.global.elements.line.borderWidth = 2;
    // Chart.defaults.global.elements.line.borderColor = 'rgba(1,1,1,1.0)';

    // Chart.defaults.global.elements.point.borderColor = 'rgba(0,0,0,1.0)';
    // Chart.defaults.global.elements.point.borderWidth = 1;
    var myChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: time,
        datasets: [{
          label: 'Key',
          data: value,
          pointRadius: 1,
          pointHoverRadius: 10
        }],
      },
      options: {
        scales: {
            xAxes: [{
                display: true

            }]
        },
        title:{
                  display: true,
                  text:"Values"
              }
      }
    });

    return myChart;
}
</script>
</body>
